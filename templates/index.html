<!DOCTYPE html>
<html>
<head>
  <title>MindMate</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}" />
</head>

<body>
  <div class="wrapper">
    <h3 class="chat-bubble-header">Talk to MindMate</h3>
    <div class="conversation-box" id="conversation-box">
      {% for message in conversation %}
        <div class="line {% if message.get('speaker') == 'You' %}right{% else %}left{% endif %}">
          <span class="speaker">{{ message['speaker'] }}:</span> {{ message['message'] }}
        </div>
      {% endfor %}
    </div>
    <div class="form-container">
      <form action="/" method="POST">
        <input type="text" name="question" placeholder="Is there anything you'd like to discuss?" required />
        <input type="submit" value="Submit" />
        <input type="hidden" name="conversation" value="{{ conversation_json }}" />
      </form>
      <button type="button" onclick="clearConversation()">Clear conversation history</button>
    </div>
  </div>
  {% if result %}
    <div class="result-box">
      <div class="result">{{ result|safe }}</div>
    </div>
  {% endif %}
  <script>
    function clearConversation() {
      if (confirm("Are you sure you want to clear the conversation history?")) {
        document.querySelector("[name='conversation']").value = "[]";
        const conversationBox = document.getElementById("conversation-box");
        while (conversationBox.firstChild) {
          conversationBox.removeChild(conversationBox.firstChild);
        }
      }
    }
  </script>
</body>
</html>
